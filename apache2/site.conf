<VirtualHost *:80>
 ServerName your.host-name
LogLevel debug
RewriteEngine on
 
    DocumentRoot /var/www/noaccess
    <Directory "/var/www/noaccess">
        Options FollowSymLinks
        AllowOverride All
        Require all granted
    </Directory>

 # Define RewriteMap to read allowed IPs from file
    RewriteMap allowedips txt:/etc/apache-allow/allowed_ips.conf

    # Check if the requester's IP is in the allowed IPs
    RewriteCond %{REMOTE_ADDR} ^(.+)$
    RewriteCond %{REMOTE_ADDR} !^192\.168\.|^10\.
    RewriteCond ${allowedips:%1|NOT-FOUND} =NOT-FOUND
    RewriteRule ^(.*)$ /var/www/noaccess/index.php [L]

    # If IP is in allowed IP ranges, perform reverse proxy
    ProxyPass / http://127.0.0.1:8080/
    ProxyPassReverse / http://127.0.0.1:8080/

</VirtualHost>

